<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© - NWC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; direction: rtl; }
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .header { text-align: center; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; background: #fff; }
        .form-input[readonly] { background: #e9ecef; color: #495057; }
        .btn { padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; margin-top: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:disabled { background: #ccc; }
        .btn-gps { background: #28a745; color: white; margin-bottom: 15px; }
        .btn-photo { background: #6c757d; color: white; }
        .photo-preview { display: flex; gap: 10px; margin-top: 10px; overflow-x: auto; padding-bottom: 5px; }
        .photo-item { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        .success-msg { color: #28a745; text-align: center; font-weight: bold; margin-top: 10px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h2 style="color: #007bff;">ğŸ“ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†</h2>
                <p style="font-size: 14px; color: #666;">Ø´Ø±ÙƒØ© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„ÙˆØ·Ù†ÙŠØ© - NWC</p>
            </div>
            
            <button type="button" class="btn btn-gps" onclick="getLocation()">ğŸ›°ï¸ Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)</button>
            
            <form id="locationForm">
                <div class="form-group">
                    <label class="form-label">Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                    <input type="text" class="form-input" id="coords" readonly placeholder="Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± GPS Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ *</label>
                    <input type="text" class="form-input" id="siteName" required placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø­ÙŠ Ø§Ù„Ø³Ø¯">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± *</label>
                    <input type="text" class="form-input" id="propertyNumber" required placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ù‚Ù… Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙŠØ§Ù‡ *</label>
                    <input type="text" class="form-input" id="waterMeterNumber" required placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ© *</label>
                    <input type="number" class="form-input" id="waterMeterReading" required step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ØµÙˆØ± (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 3 ØµÙˆØ±)</label>
                    <input type="file" id="photoInput" accept="image/*" multiple style="display:none">
                    <button type="button" class="btn btn-photo" onclick="document.getElementById('photoInput').click()">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±</button>
                    <div id="photoPreview" class="photo-preview"></div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù€ Google Sheets</button>
                <div id="successMsg" class="success-msg">âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ.</div>
            </form>
        </div>
    </div>

    <script>
        let currentPhotos = [];
        // ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxdK890_RqdTjBGj_aACVuwRIKcDFkzgAHaCPvaphJgbFQCp8JfW5Mv_VwyMfL9n4WfaA/exec';

        // ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª GPS
        function getLocation() {
            const btn = event.target;
            btn.textContent = "âŒ› Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    document.getElementById('coords').value = `${pos.coords.latitude}, ${pos.coords.longitude}`;
                    btn.textContent = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
                    btn.style.background = "#155724";
                }, () => {
                    alert("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS ÙˆÙ…Ù†Ø­ Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ø°Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹");
                    btn.textContent = "ğŸ›°ï¸ Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)";
                });
            } else {
                alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹");
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù€ Base64 Ù„Ø±ÙØ¹Ù‡Ø§ Ù„Ù€ Drive
        document.getElementById('photoInput').addEventListener('change', function(e) {
            Array.from(e.target.files).forEach(file => {
                if (currentPhotos.length < 3) {
                    const reader = new FileReader();
                    reader.onload = event => {
                        currentPhotos.push(event.target.result);
                        renderPhotos();
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        function renderPhotos() {
            document.getElementById('photoPreview').innerHTML = currentPhotos.map(p => `
                <div class="photo-item">
                    <img src="${p}">
                </div>
            `).join('');
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø­Ø±Ùƒ
        document.getElementById('locationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            const msg = document.getElementById('successMsg');
            
            btn.disabled = true;
            btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";

            const payload = {
                id: Date.now().toString(),
                siteName: document.getElementById('siteName').value,
                propertyNumber: document.getElementById('propertyNumber').value,
                waterMeterNumber: document.getElementById('waterMeterNumber').value,
                waterMeterReading: document.getElementById('waterMeterReading').value,
                coords: document.getElementById('coords').value,
                photos: currentPhotos // Ø§Ù„ØµÙˆØ± Ù„Ø±ÙØ¹Ù‡Ø§ Ù„Ù€ Drive
            };

            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… mode: 'no-cors' Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª
                await fetch(SCRIPT_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    cache: 'no-cache',
                    body: JSON.stringify(payload) 
                });

                // ØªØµÙÙŠØ± Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ
                msg.style.display = 'block';
                this.reset();
                currentPhotos = [];
                renderPhotos();
                document.querySelector('.btn-gps').textContent = "ğŸ›°ï¸ Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)";
                document.querySelector('.btn-gps').style.background = "#28a745";
                
                setTimeout(() => { msg.style.display = 'none'; }, 5000);
                alert("âœ… Ø±ÙˆØ¹Ø©! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¬Ø¯ÙˆÙ„ Ø¬ÙˆØ¬Ù„ ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ± Ù„Ù€ Drive Ø¨Ù†Ø¬Ø§Ø­.");
                
            } catch (err) {
                console.error(err);
                alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
            } finally {
                btn.disabled = false;
                btn.textContent = "ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù€ Google Sheets";
            }
        });
    </script>
</body>
</html>
