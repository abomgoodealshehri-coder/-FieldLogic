<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© - NWC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; direction: rtl; }
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 20px; border-top: 5px solid #007bff; }
        .header { text-align: center; margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        .form-input { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; background: #fff; }
        .form-input[readonly] { background: #f8f9fa; color: #555; }
        .btn { padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; margin-top: 10px; }
        .btn-primary { background: #007bff; color: white; box-shadow: 0 4px 15px rgba(0,123,255,0.3); }
        .btn-primary:disabled { background: #a5a5a5; cursor: not-allowed; }
        .btn-gps { background: #28a745; color: white; margin-bottom: 15px; }
        .btn-photo { background: #6c757d; color: white; }
        .photo-preview { display: flex; gap: 12px; margin-top: 15px; overflow-x: auto; padding: 5px; }
        .photo-item { position: relative; width: 90px; height: 90px; flex-shrink: 0; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .success-msg { color: #28a745; text-align: center; font-weight: bold; margin-top: 15px; display: none; background: #e8f5e9; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <h2 style="color: #007bff; font-size: 24px;">ğŸ“ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†</h2>
                <p style="color: #666; margin-top: 5px;">Ø´Ø±ÙƒØ© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„ÙˆØ·Ù†ÙŠØ© - NWC</p>
            </div>
            
            <button type="button" class="btn btn-gps" id="gpsBtn" onclick="getLocation()">ğŸ›°ï¸ Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS)</button>
            
            <form id="locationForm">
                <div class="form-group">
                    <label class="form-label">Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                    <input type="text" class="form-input" id="coords" readonly placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‡Ù†Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ *</label>
                    <input type="text" class="form-input" id="siteName" required placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø­ÙŠ Ø§Ù„Ø´Ø§Ø·Ø¦">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± *</label>
                    <input type="text" class="form-input" id="propertyNumber" required placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ù‚Ù… Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙŠØ§Ù‡ *</label>
                    <input type="text" class="form-input" id="waterMeterNumber" required placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ© *</label>
                    <input type="number" class="form-input" id="waterMeterReading" required step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">ØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØµÙˆØ± (Ø­ØªÙ‰ 3 ØµÙˆØ±)</label>
                    <input type="file" id="photoInput" accept="image/*" multiple style="display:none">
                    <button type="button" class="btn btn-photo" onclick="document.getElementById('photoInput').click()">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±</button>
                    <div id="photoPreview" class="photo-preview"></div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <div id="successMsg" class="success-msg">âœ… Ø±ÙˆØ¹Ø©! ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ± Ø¨Ù†Ø¬Ø§Ø­.</div>
            </form>
        </div>
    </div>

    <script>
        let currentPhotos = [];
        // Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Exec Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù…Ù†Ø¸Ù…
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyGzxTgA-6m_BsAtf1l6VHSh_azGSTzYjl_lzK4Tun80dE-_CHhh_a3lzb6voCerzoP/exec';

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ GPS
        function getLocation() {
            const btn = document.getElementById('gpsBtn');
            btn.textContent = "âŒ› Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...";
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    document.getElementById('coords').value = `${pos.coords.latitude}, ${pos.coords.longitude}`;
                    btn.textContent = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
                    btn.style.background = "#155724";
                }, () => {
                    alert("âš ï¸ ÙØ¶Ù„Ø§Ù‹ Ù‚Ù… Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„");
                    btn.textContent = "ğŸ›°ï¸ Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS)";
                });
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙˆØ±ÙØ¹Ù‡Ø§
        document.getElementById('photoInput').addEventListener('change', function(e) {
            Array.from(e.target.files).forEach(file => {
                if (currentPhotos.length < 3) {
                    const reader = new FileReader();
                    reader.onload = event => {
                        currentPhotos.push(event.target.result);
                        renderPhotos();
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        function renderPhotos() {
            document.getElementById('photoPreview').innerHTML = currentPhotos.map(p => `
                <div class="photo-item"><img src="${p}"></div>
            `).join('');
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        document.getElementById('locationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            const msg = document.getElementById('successMsg');
            
            btn.disabled = true;
            btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù€ NWC...";

            const payload = {
                id: Date.now().toString(),
                siteName: document.getElementById('siteName').value,
                propertyNumber: document.getElementById('propertyNumber').value,
                waterMeterNumber: document.getElementById('waterMeterNumber').value,
                waterMeterReading: document.getElementById('waterMeterReading').value,
                coords: document.getElementById('coords').value,
                photos: currentPhotos // Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù„Ù„Ø¯Ø±Ø§ÙŠÙ
            };

            try {
                // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨ØµÙŠØºØ© no-cors Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù†Ø¬Ø§Ø­
                await fetch(SCRIPT_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    body: JSON.stringify(payload) 
                });

                msg.style.display = 'block';
                this.reset();
                currentPhotos = [];
                renderPhotos();
                document.getElementById('gpsBtn').textContent = "ğŸ›°ï¸ Ø¬Ù„Ø¨ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS)";
                document.getElementById('gpsBtn').style.background = "#28a745";
                
                setTimeout(() => { msg.style.display = 'none'; }, 6000);
                alert("âœ… Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø¨Ø·Ù„! Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØµÙ„Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„ØµÙˆØ± Ø±ÙÙØ¹Øª Ù„Ù„Ø¯Ø±Ø§ÙŠÙ.");
                
            } catch (err) {
                alert("âŒ Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø©ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©");
            } finally {
                btn.disabled = false;
                btn.textContent = "ğŸ’¾ Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
            }
        });
    </script>
</body>
</html>
