<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© - NWC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        .header {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon {
            width: 45px; height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 22px; flex-shrink: 0;
        }
        .logo-text h1 { font-size: 18px; color: #333; margin-bottom: 3px; }
        .logo-text p { font-size: 12px; color: #666; }
        .btn {
            padding: 12px 24px; border: none; border-radius: 8px;
            font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; width: 100%;
        }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-secondary { background: white; color: #667eea; border: 2px solid #667eea; }
        .nav-tabs {
            background: white; border-radius: 15px; padding: 8px;
            margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }
        .nav-tab { padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: #666; background: transparent; }
        .nav-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px; }
        .form-input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        .photo-upload { border: 2px dashed #ddd; border-radius: 8px; padding: 30px; text-align: center; cursor: pointer; background: #f8f9ff; }
        .photo-preview { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 10px; }
        .photo-item { position: relative; border-radius: 8px; overflow: hidden; height: 100px; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .photo-remove { position: absolute; top: 2px; left: 2px; background: red; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; }
        .alert { padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; display: block; }
        .hidden { display: none !important; }
        .location-card { background: #f8f9fa; border-radius: 12px; padding: 15px; margin-bottom: 12px; border-right: 5px solid #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ“</div>
                <div class="logo-text">
                    <h1>Ù†Ø¸Ø§Ù… Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</h1>
                    <p>Field Data Collection System</p>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('field')">ğŸ“± Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="nav-tab" onclick="switchTab('office')">ğŸ’¼ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        <div id="fieldTab" class="tab-content active">
            <div class="card">
                <form id="locationForm">
                    <div class="form-group">
                        <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ *</label>
                        <input type="text" class="form-input" id="siteName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± *</label>
                        <input type="text" class="form-input" id="propertyNumber" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙŠØ§Ù‡ *</label>
                        <input type="text" class="form-input" id="waterMeterNumber" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ÙŠØ§Ù‡ *</label>
                        <input type="number" class="form-input" id="waterMeterReading" required step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØµÙˆØ± (Ø­ØªÙ‰ 3 ØµÙˆØ±)</label>
                        <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                            ğŸ“¸ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±
                            <input type="file" id="photoInput" accept="image/*" multiple style="display: none;">
                        </div>
                        <div id="photoPreview" class="photo-preview"></div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets</button>
                </form>
            </div>
        </div>

        <div id="officeTab" class="tab-content">
            <div class="card">
                <h2>Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹</h2>
                <div id="locationsList" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPhotos = [];
        let allLocations = JSON.parse(localStorage.getItem('fieldDataLocations') || '[]');

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            if(tabName === 'office') displayLocations();
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                if (currentPhotos.length < 3) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        currentPhotos.push({ dataUrl: event.target.result });
                        displayPhotoPreviews();
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        function displayPhotoPreviews() {
            const container = document.getElementById('photoPreview');
            container.innerHTML = currentPhotos.map((p, i) => `
                <div class="photo-item">
                    <img src="${p.dataUrl}">
                    <button type="button" class="photo-remove" onclick="removePhoto(${i})">Ã—</button>
                </div>
            `).join('');
        }

        function removePhoto(i) {
            currentPhotos.splice(i, 1);
            displayPhotoPreviews();
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„Ø±ÙØ¹ Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
        document.getElementById('locationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            
            const data = {
                id: Date.now().toString(),
                siteName: document.getElementById('siteName').value,
                propertyNumber: document.getElementById('propertyNumber').value,
                waterMeterNumber: document.getElementById('waterMeterNumber').value,
                waterMeterReading: document.getElementById('waterMeterReading').value
            };

            try {
                btn.disabled = true;
                btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Google Sheets...';

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
                await fetch('https://script.google.com/macros/s/AKfycbydC9t4IwXzBsq8IVLHOTwx5Uo7cnnVL0P63pp7cYxHII5xJWwV_hcODrM2OFyugY-X/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    body: JSON.stringify(data)
                });

                // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© Ø£ÙŠØ¶Ø§Ù‹
                allLocations.unshift({...data, timestamp: new Date().toLocaleString(), photos: currentPhotos.map(p => p.dataUrl)});
                localStorage.setItem('fieldDataLocations', JSON.stringify(allLocations));

                alert('âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Google Sheets ÙˆØ­ÙØ¸ Ù†Ø³Ø®Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­');
                this.reset();
                currentPhotos = [];
                displayPhotoPreviews();

            } catch (error) {
                alert('âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ±ØŒ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ ÙÙ‚Ø·');
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets';
            }
        });

        function displayLocations() {
            const container = document.getElementById('locationsList');
            if (allLocations.length === 0) { container.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©.'; return; }
            container.innerHTML = allLocations.map(loc => `
                <div class="location-card">
                    <strong>${loc.siteName}</strong><br>
                    <small>${loc.timestamp}</small><br>
                    Ø¹Ù‚Ø§Ø±: ${loc.propertyNumber} | Ø¹Ø¯Ø§Ø¯: ${loc.waterMeterNumber} | Ù‚Ø±Ø§Ø¡Ø©: ${loc.waterMeterReading}
                </div>
            `).join('');
        }
    </script>
</body>
</html>
